<div th:fragment="roleTree" class="basis-1/3 min-h-[500px] border">
    <div class="flex items-center justify-between p-7 border">
        <span class="font-semibold text-lg">권한 목록</span>
        <button data-action="expandAll" class="text-blue-900">전체 펼치기</button>
    </div>

    <div class="p-7">
        <div th:replace="~{this :: roleTreeNodes(nodes=${tree})}"></div>
    </div>
</div>

<ul th:fragment="roleTreeNodes(nodes)" class="flex flex-col gap-2 w-full">
    <li th:each="node : ${nodes}"
        class="flex flex-col gap-2"
        th:data-id="${node.id}">

        <div class="flex group">
            <div class="flex items-center gap-2 px-3 py-2 hover:bg-gray-100 cursor-pointer">
                <button th:classappend="${node.children.isEmpty()} ? 'invisible pointer-events-none' : ''"
                        data-action="toggle">
                    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor"
                         class="size-3 transition-transform duration-200"
                         th:classappend="${node.depth == 0} ? 'rotate-90' : ''">
                        <path fill-rule="evenodd"
                              d="M16.28 11.47a.75.75 0 0 1 0 1.06l-7.5 7.5a.75.75 0 0 1-1.06-1.06L14.69 12 7.72 5.03a.75.75 0 0 1 1.06-1.06l7.5 7.5Z"
                              clip-rule="evenodd"/>
                    </svg>
                </button>

                <div class="flex items-center gap-2"
                     th:data-id="${node.id}"
                     data-action="selectRole">
                    <svg th:if="${!node.children.isEmpty()}" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20"
                         fill="currentColor" class="size-5">
                        <path d="M3.75 3A1.75 1.75 0 0 0 2 4.75v3.26a3.235 3.235 0 0 1 1.75-.51h12.5c.644 0 1.245.188 1.75.51V6.75A1.75 1.75 0 0 0 16.25 5h-4.836a.25.25 0 0 1-.177-.073L9.823 3.513A1.75 1.75 0 0 0 8.586 3H3.75ZM3.75 9A1.75 1.75 0 0 0 2 10.75v4.5c0 .966.784 1.75 1.75 1.75h12.5A1.75 1.75 0 0 0 18 15.25v-4.5A1.75 1.75 0 0 0 16.25 9H3.75Z"/>
                    </svg>
                    <svg th:unless="${!node.children.isEmpty()}" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20"
                         fill="currentColor" class="size-5">
                        <path d="M4.75 3A1.75 1.75 0 0 0 3 4.75v2.752l.104-.002h13.792c.035 0 .07 0 .104.002V6.75A1.75 1.75 0 0 0 15.25 5h-3.836a.25.25 0 0 1-.177-.073L9.823 3.513A1.75 1.75 0 0 0 8.586 3H4.75ZM3.104 9a1.75 1.75 0 0 0-1.673 2.265l1.385 4.5A1.75 1.75 0 0 0 4.488 17h11.023a1.75 1.75 0 0 0 1.673-1.235l1.384-4.5A1.75 1.75 0 0 0 16.896 9H3.104Z"/>
                    </svg>
                    <span th:text="${node.roleName}"></span>
                </div>
            </div>

            <div class="relative ml-auto flex items-center"
                 data-action="openEditMenu">
                <button class="opacity-0 group-hover:opacity-100 transition hover:cursor-pointer">
                    <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5"
                         stroke="currentColor" class="size-4">
                        <path stroke-linecap="round" stroke-linejoin="round"
                              d="M12 6.75a.75.75 0 1 1 0-1.5.75.75 0 0 1 0 1.5ZM12 12.75a.75.75 0 1 1 0-1.5.75.75 0 0 1 0 1.5ZM12 18.75a.75.75 0 1 1 0-1.5.75.75 0 0 1 0 1.5Z"/>
                    </svg>
                </button>
                <div class="edit-menu absolute hidden top-full right-0 z-5 w-48 rounded-md shadow-lg ring-1 ring-black/5 focus:outline-none">
                    <ul>
                        <li class="flex items-center gap-2 px-4 py-3 hover:bg-gray-100 cursor-pointer border"
                            data-action="openAddChildRoleModal">
                            <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5"
                                 stroke="currentColor" class="size-4">
                                <path stroke-linecap="round" stroke-linejoin="round" d="M12 4.5v15m7.5-7.5h-15"/>
                            </svg>
                            <span>하위 권한 추가</span>
                        </li>
                        <li class="flex items-center gap-2 px-4 py-3 hover:bg-gray-100 cursor-pointer border"
                            data-action="openEditRoleModal">
                            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor"
                                 class="size-4">
                                <path d="m5.433 13.917 1.262-3.155A4 4 0 0 1 7.58 9.42l6.92-6.918a2.121 2.121 0 0 1 3 3l-6.92 6.918c-.383.383-.84.685-1.343.886l-3.154 1.262a.5.5 0 0 1-.65-.65Z"/>
                                <path d="M3.5 5.75c0-.69.56-1.25 1.25-1.25H10A.75.75 0 0 0 10 3H4.75A2.75 2.75 0 0 0 2 5.75v9.5A2.75 2.75 0 0 0 4.75 18h9.5A2.75 2.75 0 0 0 17 15.25V10a.75.75 0 0 0-1.5 0v5.25c0 .69-.56 1.25-1.25 1.25h-9.5c-.69 0-1.25-.56-1.25-1.25v-9.5Z"/>
                            </svg>
                            <span>권한 수정</span>
                        </li>
                        <li class="flex items-center gap-2 px-4 py-3 hover:bg-red-100 text-red-700 cursor-pointer border"
                            data-action="openDeleteRoleModal">
                            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor"
                                 class="size-4">
                                <path fill-rule="evenodd"
                                      d="M8.75 1A2.75 2.75 0 0 0 6 3.75v.443c-.795.077-1.584.176-2.365.298a.75.75 0 1 0 .23 1.482l.149-.022.841 10.518A2.75 2.75 0 0 0 7.596 19h4.807a2.75 2.75 0 0 0 2.742-2.53l.841-10.52.149.023a.75.75 0 0 0 .23-1.482A41.03 41.03 0 0 0 14 4.193V3.75A2.75 2.75 0 0 0 11.25 1h-2.5ZM10 4c.84 0 1.673.025 2.5.075V3.75c0-.69-.56-1.25-1.25-1.25h-2.5c-.69 0-1.25.56-1.25 1.25v.325C8.327 4.025 9.16 4 10 4ZM8.58 7.72a.75.75 0 0 0-1.5.06l.3 7.5a.75.75 0 1 0 1.5-.06l-.3-7.5Zm4.34.06a.75.75 0 1 0-1.5-.06l-.3 7.5a.75.75 0 1 0 1.5.06l.3-7.5Z"
                                      clip-rule="evenodd"/>
                            </svg>
                            <span>권한 삭제</span>
                        </li>
                    </ul>
                </div>
            </div>
        </div>

        <ul th:if="${!node.children.isEmpty()}"
            class="ml-4"
            th:data-parent="${node.roleKey}"
            th:classappend="${node.depth >= 1} ? 'hidden' : ''">
            <div th:replace="~{this :: roleTreeNodes(nodes=${node.children})}"></div>
        </ul>
    </li>
</ul>